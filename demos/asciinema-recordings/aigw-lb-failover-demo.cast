{"version": 2, "width": 160, "height": 45, "timestamp": 1734993698, "env": {"SHELL": "/bin/zsh", "TERM": "xterm-256color"}}
[0.10616, "o", "\u001b[1m\u001b[7m%\u001b[27m\u001b[1m\u001b[0m                                                                                                                                                               \r \r"]
[0.106608, "o", "\r\u001b[0m\u001b[27m\u001b[24m\u001b[Jalexly-solo@solo-system-aly lb-failover-demo % \u001b[K\u001b[?2004h"]
[1.495136, "o", "."]
[1.524731, "o", "\b./"]
[1.69747, "o", "d"]
[1.854018, "o", "e"]
[2.428503, "o", "mo-script.sh\u001b[1m \u001b[0m"]
[3.019981, "o", "\b\u001b[0m \b\u001b[?2004l\r\r\n"]
[3.024242, "o", "Select the protocol:\r\n1) http\r\n2) https\r\n"]
[3.024331, "o", "Enter your choice: "]
[4.804827, "o", "2"]
[5.258843, "o", "\r\n"]
[5.259135, "o", "\r\nSelect the port:\r\n1) 443 (default)\r\n2) Custom\r\n"]
[5.259172, "o", "Enter your choice: "]
[6.545327, "o", "1"]
[7.473121, "o", "\r\n"]
[7.473491, "o", "\r\nUsing protocol: https\r\n"]
[7.473542, "o", "Using port: 443\r\n\r\n"]
[7.47367, "o", "Starting the Load Balancing and Failover Demo...\r\n\r\n"]
[7.47388, "o", "Step 1: Review example upstream configurations. Press enter to proceed..."]
[10.699525, "o", "\r\n"]
[10.699835, "o", "\r\n"]
[10.706006, "o", "apiVersion: gloo.solo.io/v1\r\nkind: Upstream\r\nmetadata:\r\n  name: ollama-qwen-0.5-upstream\r\n  namespace: gloo-system\r\nspec:\r\n  ai:\r\n    openai:\r\n      customHost:\r\n        host: ollama-qwen.ollama.svc.cluster.local\r\n        port: 11434\r\n      model: qwen:0.5b"]
[10.706432, "o", "\r\n---\r\n"]
[10.710451, "o", "apiVersion: gloo.solo.io/v1\r\nkind: Upstream\r\nmetadata:\r\n  name: ollama-qwen-1.8-upstream\r\n  namespace: gloo-system\r\nspec:\r\n  ai:\r\n    openai:\r\n      customHost:\r\n        host: ollama-qwen.ollama.svc.cluster.local\r\n        port: 11434\r\n      model: qwen:1.8b"]
[10.710797, "o", "\r\n\r\n"]
[10.710823, "o", "Step 2: Review HTTPRoute for 50-50 traffic split. Press enter to proceed..."]
[19.289781, "o", "\r\n"]
[19.290104, "o", "\r\n"]
[19.296061, "o", "apiVersion: gateway.networking.k8s.io/v1\r\nkind: HTTPRoute\r\nmetadata:\r\n  name: ollama-qwen\r\n  namespace: gloo-system\r\nspec:\r\n  parentRefs:\r\n  - name: ai-gateway\r\n    namespace: gloo-system\r\n  rules:\r\n  - backendRefs:\r\n    - group: gloo.solo.io\r\n      kind: Upstream\r\n      name: ollama-qwen-0.5-upstream\r\n      namespace: gloo-system\r\n      weight: 50\r\n    - group: gloo.solo.io\r\n      kind: Upstream\r\n      name: ollama-qwen-1.8-upstream\r\n      namespace: gloo-system\r\n      weight: 50\r\n    filters:\r\n    - extensionRef:\r\n        group: gateway.solo.io\r\n        kind: RouteOption\r\n        name: ollama-qwen-route-policies\r\n      type: ExtensionRef\r\n    matches:\r\n    - path:\r\n        type: PathPrefix\r\n        value: /qwen\r\n---\r\napiVersion: gateway.solo.io/v1\r\nkind: RouteOption\r\nmetadata:\r\n  name: ollama-qwen-route-policies\r\n  namespace: gloo-system\r\nspec:\r\n  options:\r\n    jwt:\r\n      disable: true\r\n    prefixRewrite: /v1/chat/completions\r\n\r\n"]
[19.296514, "o", "\r\n"]
[19.296686, "o", "Step 3: Apply 50-50 traffic shift configuration. Press enter to proceed..."]
[31.737698, "o", "\r\n"]
[31.864751, "o", "upstream.gloo.solo.io/ollama-qwen-0.5-upstream created\r\n"]
[31.873554, "o", "upstream.gloo.solo.io/ollama-qwen-1.8-upstream created\r\n"]
[31.87967, "o", "httproute.gateway.networking.k8s.io/ollama-qwen created\r\n"]
[31.897965, "o", "routeoption.gateway.solo.io/ollama-qwen-route-policies created\r\n"]
[31.899108, "o", "\r\nStep 4: Retrieve the AI Gateway Load Balancer address. Press enter to proceed..."]
[35.192857, "o", "\r\n"]
[35.238564, "o", "Gateway IP: 192.168.107.2\r\n\r\nStep 5: Test the traffic distribution.\r\n"]
[35.238703, "o", "Press Enter to send a request, or type 'next' to move on: "]
[40.244241, "o", "\r\n"]
[40.244548, "o", "Sending request to AI Gateway...\r\n\r\n"]
[42.251057, "o", "HTTP/2 200 \r\r\n\u001b[1mcontent-type\u001b[0m: application/json\r\r\n\u001b[1mdate\u001b[0m: Mon, 23 Dec 2024 22:42:21 GMT\r\r\n\u001b[1mx-envoy-upstream-service-time\u001b[0m: 1918\r\r\n\u001b[1mserver\u001b[0m: envoy\r\r\n\r\r\n{\"id\": \"chatcmpl-982\", \"object\": \"chat.completion\", \"created\": 1734993741, \"model\": \"qwen:1.8b\", \"system_fingerprint\": \"fp_ollama\", \"choices\": [{\"index\": 0, \"message\": {\"role\": \"assistant\", \"content\": \"Improve API Gateway integration in your Kubernetes cluster with advanced cloud-native capabilities. Utilize AI to automate route selection, error handling, and security features. Enhance API Gateway performance and scalability through horizontal replication and load balancing strategies. Join the growing number of businesses leveraging AI-powered API Gateways within their Kubernetes clusters for seamless API management.\"}, \"finish_reason\": \"stop\"}], \"usage\": {\"prompt_tokens\": 66, \"completion_tokens\": 67, \"total_tokens\": 133}}"]
[42.25171, "o", "\r\n\r\nResponses should show a 50-50 distribution between qwen-0.5b and qwen-1.8b models.\r\n"]
[42.251732, "o", "\r\nPress Enter to send a request, or type 'next' to move on: "]
[47.702426, "o", "\r\n"]
[47.702706, "o", "Sending request to AI Gateway...\r\n\r\n"]
[48.619254, "o", "HTTP/2 200 \r\r\n\u001b[1mcontent-type\u001b[0m: application/json\r\r\n\u001b[1mdate\u001b[0m: Mon, 23 Dec 2024 22:42:27 GMT\r\r\n\u001b[1mx-envoy-upstream-service-time\u001b[0m: 856\r\r\n\u001b[1mserver\u001b[0m: envoy\r\r\n\r\r\n"]
[48.619282, "o", "{\"id\": \"chatcmpl-532\", \"object\": \"chat.completion\", \"created\": 1734993747, \"model\": \"qwen:0.5b\", \"system_fingerprint\": \"fp_ollama\", \"choices\": [{\"index\": 0, \"message\": {\"role\": \"assistant\", \"content\": \"Enter the power of machine learning at your cost. With AI gateways, you'll have access to intelligent resources that can help streamline tasks, improve communication and reduce costs.\\n\\nYour choice: choose Kubernetes's cloud native solutions architect, skilled in explaining complex technical concepts such as API Gateway, microservices, LLM operations, kubernetes, and advanced networking patterns.\"}, \"finish_reason\": \"stop\"}], \"usage\": {\"prompt_tokens\": 66, \"completion_tokens\": 72, \"total_tokens\": 138}}"]
[48.619901, "o", "\r\n\r\nResponses should show a 50-50 distribution between qwen-0.5b and qwen-1.8b models.\r\n\r\nPress Enter to send a request, or type 'next' to move on: "]
[51.385242, "o", "\r\n"]
[51.385336, "o", "Sending request to AI Gateway...\r\n\r\n"]
[53.017286, "o", "HTTP/2 200 \r\r\n\u001b[1mcontent-type\u001b[0m: application/json\r\r\n\u001b[1mdate\u001b[0m: Mon, 23 Dec 2024 22:42:31 GMT\r\r\n\u001b[1mx-envoy-upstream-service-time\u001b[0m: 1572\r\r\n\u001b[1mserver\u001b[0m: envoy\r\r\n\r\r\n"]
[53.017326, "o", "{\"id\": \"chatcmpl-110\", \"object\": \"chat.completion\", \"created\": 1734993751, \"model\": \"qwen:1.8b\", \"system_fingerprint\": \"fp_ollama\", \"choices\": [{\"index\": 0, \"message\": {\"role\": \"assistant\", \"content\": \"Enhance your Kubernetes applications with an AI gateway. Utilize machine learning algorithms to route traffic efficiently, reducing latency and improving application performance. With the help of an AI gateway, you can leverage Kubernetes's powerful API for creating complex applications that deliver exceptional user experiences.\"}, \"finish_reason\": \"stop\"}], \"usage\": {\"prompt_tokens\": 66, \"completion_tokens\": 53, \"total_tokens\": 119}}"]
[53.017898, "o", "\r\n\r\nResponses should show a 50-50 distribution between qwen-0.5b and qwen-1.8b models.\r\n"]
[53.017913, "o", "\r\nPress Enter to send a request, or type 'next' to move on: "]
[55.505525, "o", "n"]
[55.977157, "o", "e"]
[56.275914, "o", "x"]
[56.644912, "o", "t"]
[57.945173, "o", "\r\n"]
[57.94531, "o", "Exiting traffic distribution test.\r\n\r\n"]
[57.945335, "o", "Step 6: Configure local-to-local failover example. Press enter to proceed..."]
[63.27908, "o", "\r\n"]
[63.279458, "o", "\r\n"]
[63.285364, "o", "apiVersion: gloo.solo.io/v1\r\nkind: Upstream\r\nmetadata:\r\n  labels:\r\n    app: gloo\r\n  name: aig-failover\r\n  namespace: gloo-system\r\nspec:\r\n  ai:\r\n    multi:\r\n      priorities:\r\n      - pool:\r\n        - openai:\r\n            customHost:\r\n              host: ollama-qwen.ollama.svc.cluster.local\r\n              port: 11434\r\n            model: qwen:1.8b\r\n      - pool:\r\n        - openai:\r\n            customHost:\r\n              host: ollama-qwen.ollama.svc.cluster.local\r\n              port: 11434\r\n            model: qwen:0.5b"]
[63.285777, "o", "\r\n---\r\n"]
[63.290358, "o", "apiVersion: gateway.networking.k8s.io/v1\r\nkind: HTTPRoute\r\nmetadata:\r\n  name: ollama-qwen-failover\r\n  namespace: gloo-system\r\nspec:\r\n  parentRefs:\r\n  - name: ai-gateway\r\n    namespace: gloo-system\r\n  rules:\r\n  - backendRefs:\r\n    - group: gloo.solo.io\r\n      kind: Upstream\r\n      name: aig-failover\r\n      namespace: gloo-system\r\n    filters:\r\n    - extensionRef:\r\n        group: gateway.solo.io\r\n        kind: RouteOption\r\n        name: ollama-qwen-failover-route-policies\r\n      type: ExtensionRef\r\n    matches:\r\n    - path:\r\n        type: PathPrefix\r\n        value: /failover\r\n---\r\napiVersion: gateway.solo.io/v1\r\nkind: RouteOption\r\nmetadata:\r\n  name: ollama-qwen-failover-route-policies\r\n  namespace: gloo-system\r\nspec:\r\n  options:\r\n    jwt:\r\n      disable: true\r\n    prefixRewrite: /v1/chat/completions\r\n    retries:\r\n      retryOn: 'retriable-status-codes'\r\n      numRetries: 3\r\n      previousPriorities:\r\n        updateFrequency: 1"]
[63.290675, "o", "\r\n"]
[63.397928, "o", "httproute.gateway.networking.k8s.io/ollama-qwen-failover created\r\n"]
[63.417109, "o", "routeoption.gateway.solo.io/ollama-qwen-failover-route-policies created\r\n"]
[63.42659, "o", "upstream.gloo.solo.io/aig-failover created\r\n"]
[63.427988, "o", "\r\n"]
[63.428084, "o", "Local-to-local failover configuration applied.\r\n\r\nTesting /failover endpoint.\r\n"]
[63.428213, "o", "Press Enter to send a request, or type 'next' to move on: "]
[72.870042, "o", "\r\n"]
[72.870268, "o", "\r\nSending request to failover endpoint...\r\n\r\n"]
[75.433621, "o", "HTTP/2 200 \r\r\n\u001b[1mcontent-type\u001b[0m: application/json\r\r\n\u001b[1mdate\u001b[0m: Mon, 23 Dec 2024 22:42:54 GMT\r\r\n\u001b[1mx-envoy-upstream-service-time\u001b[0m: 2515\r\r\n\u001b[1mserver\u001b[0m: envoy\r\r\n\r\r\n{\"id\": \"chatcmpl-494\", \"object\": \"chat.completion\", \"created\": 1734993774, \"model\": \"qwen:1.8b\", \"system_fingerprint\": \"fp_ollama\", \"choices\": [{\"index\": 0, \"message\": {\"role\": \"assistant\", \"content\": \"Introducing AI Gateway for your Kubernetes cluster. Our platform simplifies API gateway management with seamless integration, microservices orchestration, and powerful analytics capabilities. Utilize AI Gateway to optimize API endpoints, eliminate manual configuration efforts, leverage real-time stream data processing, enhance incident investigation, boost performance monitoring visibility, and much more. Join the revolution in cloud-native solutions by leveraging AI Gateway for your Kubernetes cluster today!\"}, \"finish_reason\": \"stop\"}], \"usage\": {\"prompt_tokens\": 66, \"completion_tokens\": 82, \"total_tokens\": 148}}"]
[75.434288, "o", "\r\n\r\n"]
[75.434302, "o", "Responses should come from qwen-1.8b unless it's unhealthy, in which case it will fail over to qwen-0.5b.\r\n\r\n"]
[75.434379, "o", "Press Enter to send a request, or type 'next' to move on: "]
[79.471717, "o", "\r\n"]
[79.471999, "o", "\r\nSending request to failover endpoint...\r\n\r\n"]
[81.098033, "o", "HTTP/2 200 \r\r\n\u001b[1mcontent-type\u001b[0m: application/json\r\r\n\u001b[1mdate\u001b[0m: Mon, 23 Dec 2024 22:43:00 GMT\r\r\n\u001b[1mx-envoy-upstream-service-time\u001b[0m: 1565\r\r\n\u001b[1mserver\u001b[0m: envoy\r\r\n\r\r\n{\"id\": \"chatcmpl-297\", \"object\": \"chat.completion\", \"created\": 1734993780, \"model\": \"qwen:1.8b\", \"system_fingerprint\": \"fp_ollama\", \"choices\": [{\"index\": 0, \"message\": {\"role\": \"assistant\", \"content\": \"Elevate your Kubernetes workload with an AI gateway that simplifies the integration of external APIs and services. By leveraging AI gateways, you can achieve cost-effective and efficient management of your Kubernetes applications. #Kubernetes #AIGateway #ExternalAPIs\"}, \"finish_reason\": \"stop\"}], \"usage\": {\"prompt_tokens\": 66, \"completion_tokens\": 51, \"total_tokens\": 117}}"]
[81.098576, "o", "\r\n\r\n"]
[81.09859, "o", "Responses should come from qwen-1.8b unless it's unhealthy, in which case it will fail over to qwen-0.5b.\r\n\r\n"]
[81.098691, "o", "Press Enter to send a request, or type 'next' to move on: "]
[84.138997, "o", "n"]
[84.235398, "o", "e"]
[84.446903, "o", "x"]
[84.772479, "o", "t"]
[85.599524, "o", "\r\n"]
[85.599909, "o", "\r\n\r\nStep 8: Simulate failover errors. Press enter to proceed..."]
[90.951577, "o", "\r\n"]
[90.951704, "o", "\r\n"]
[90.95375, "o", "apiVersion: gloo.solo.io/v1\r\nkind: Upstream\r\nmetadata:\r\n  labels:\r\n    app: gloo\r\n  name: aig-failover\r\n  namespace: gloo-system\r\nspec:\r\n  ai:\r\n    multi:\r\n      priorities:\r\n      - pool:\r\n        - openai:\r\n            customHost:\r\n              # invalid host\r\n              host: invalidhost.foo.bar\r\n              # 429 status code\r\n              #host: httpbin.org/status/429\r\n            model: qwen:1.8b\r\n      - pool:\r\n        - openai:\r\n            customHost:\r\n              host: ollama-qwen.ollama.svc.cluster.local\r\n              port: 11434\r\n            model: qwen:0.5b"]
[90.953883, "o", "\r\n"]
[91.062661, "o", "upstream.gloo.solo.io/aig-failover configured\r\n"]
[91.064177, "o", "\r\nFailover configuration with simulated errors applied.\r\n\r\nTesting /failover endpoint.\r\n"]
[91.064241, "o", "Press Enter to send a request, or type 'next' to move on: "]
[101.234293, "o", "\r\n"]
[101.234421, "o", "\r\n"]
[101.234499, "o", "Sending request to failover endpoint...\r\n\r\n"]
[102.145098, "o", "HTTP/2 200 \r\r\n\u001b[1mcontent-type\u001b[0m: application/json\r\r\n\u001b[1mdate\u001b[0m: Mon, 23 Dec 2024 22:43:21 GMT\r\r\n\u001b[1mx-envoy-upstream-service-time\u001b[0m: 827\r\r\n\u001b[1mserver\u001b[0m: envoy\r\r\n\r\r\n"]
[102.145125, "o", "{\"id\": \"chatcmpl-522\", \"object\": \"chat.completion\", \"created\": 1734993801, \"model\": \"qwen:0.5b\", \"system_fingerprint\": \"fp_ollama\", \"choices\": [{\"index\": 0, \"message\": {\"role\": \"assistant\", \"content\": \"An AI gateway provides a centralized solution for querying and interacting with the Kubernetes clusters. With this solution, you can easily manage your Kubernetes clusters, such as adding or updating members, managing storage and volume constraints, and monitoring application performance. Overall, using an AI gateway can save you a significant amount of time and money in managing your Kubernetes clusters.\"}, \"finish_reason\": \"stop\"}], \"usage\": {\"prompt_tokens\": 66, \"completion_tokens\": 69, \"total_tokens\": 135}}"]
[102.145706, "o", "\r\n\r\nResponses should now fail over to qwen-0.5b due to simulated errors on qwen-1.8b.\r\n\r\nPress Enter to send a request, or type 'next' to move on: "]
[105.820463, "o", "\r\n"]
[105.820529, "o", "\r\n"]
[105.820869, "o", "Sending request to failover endpoint...\r\n\r\n"]
[106.470795, "o", "HTTP/2 200 \r\r\n\u001b[1mcontent-type\u001b[0m: application/json\r\r\n\u001b[1mdate\u001b[0m: Mon, 23 Dec 2024 22:43:25 GMT\r\r\n\u001b[1mx-envoy-upstream-service-time\u001b[0m: 597\r\r\n\u001b[1mserver\u001b[0m: envoy\r\r\n\r\r\n{\"id\": \"chatcmpl-30\", \"object\": \"chat.completion\", \"created\": 1734993805, \"model\": \"qwen:0.5b\", \"system_fingerprint\": \"fp_ollama\", \"choices\": [{\"index\": 0, \"message\": {\"role\": \"assistant\", \"content\": \"An AI gateway improves the user experience by allowing you to easily retrieve data from various sources, such as external APIs or network services. With the help of an AI gateway, you can save time and effort in managing your Kubernetes cluster.\"}, \"finish_reason\": \"stop\"}], \"usage\": {\"prompt_tokens\": 66, \"completion_tokens\": 47, \"total_tokens\": 113}}"]
[106.471406, "o", "\r\n\r\nResponses should now fail over to qwen-0.5b due to simulated errors on qwen-1.8b.\r\n\r\n"]
[106.471421, "o", "Press Enter to send a request, or type 'next' to move on: "]
[107.682998, "o", "n"]
[107.774813, "o", "e"]
[107.954074, "o", "x"]
[108.179771, "o", "t"]
[108.845879, "o", "\r\n"]
[108.846182, "o", "\r\nExiting failover error simulation test.\r\n\r\nStep 9: Configure OpenAI to local failover. Press enter to proceed..."]
[115.533772, "o", "\r\n"]
[115.534066, "o", "\r\n"]
[115.653692, "o", "secret/openai-secret configured\r\n"]
[115.654772, "o", "\r\n"]
[115.657123, "o", "apiVersion: gloo.solo.io/v1\r\nkind: Upstream\r\nmetadata:\r\n  labels:\r\n    app: gloo\r\n  name: openai-to-local-upstream\r\n  namespace: gloo-system\r\nspec:\r\n  ai:\r\n    multi:\r\n      priorities:\r\n      - pool:\r\n        - openai:\r\n            # customHost not required, will default to api.openai.com if undefined\r\n            # but we will manipulate this to simulate an error in the next step\r\n            customHost: \r\n              host: api.openai.com\r\n            model: gpt-4o-mini\r\n            authToken:\r\n              secretRef:\r\n                name: openai-secret\r\n                namespace: gloo-system\r\n      - pool:\r\n        - openai:\r\n            customHost:\r\n              host: ollama-qwen.ollama.svc.cluster.local\r\n              port: 11434\r\n            model: qwen:0.5b"]
[115.65725, "o", "\r\n"]
[115.750492, "o", "httproute.gateway.networking.k8s.io/openai-to-local-route created\r\n"]
[115.770287, "o", "routeoption.gateway.solo.io/openai-to-local-route-policies created\r\n"]
[115.780292, "o", "upstream.gloo.solo.io/openai-to-local-upstream created\r\n"]
[115.781511, "o", "\r\nOpenAI to local failover configuration applied.\r\n"]
[115.781528, "o", "\r\n\r\nTesting OpenAI failover endpoint.\r\n"]
[115.781598, "o", "Press Enter to send a request, or type 'next' to move on: "]
[124.587904, "o", "\r\n"]
[124.588142, "o", "\r\nSending request to OpenAI endpoint...\r\n\r\n"]
[125.580507, "o", "HTTP/2 200 \r\r\n\u001b[1mdate\u001b[0m: Mon, 23 Dec 2024 22:43:44 GMT\r\r\n\u001b[1mcontent-type\u001b[0m: application/json\r\r\n\u001b[1maccess-control-expose-headers\u001b[0m: X-Request-ID\r\r\n\u001b[1mopenai-organization\u001b[0m: user-schxtck0mfttox4hkyxv6jfb\r\r\n\u001b[1mopenai-processing-ms\u001b[0m: 616\r\r\n\u001b[1mopenai-version\u001b[0m: 2020-10-01\r\r\n\u001b[1mx-ratelimit-limit-requests\u001b[0m: 10000\r\r\n\u001b[1mx-ratelimit-limit-tokens\u001b[0m: 200000\r\r\n\u001b[1mx-ratelimit-remaining-requests\u001b[0m: 9999\r\r\n\u001b[1mx-ratelimit-remaining-tokens\u001b[0m: 199913\r\r\n\u001b[1mx-ratelimit-reset-requests\u001b[0m: 8.64s\r\r\n\u001b[1mx-ratelimit-reset-tokens\u001b[0m: 25ms\r\r\n\u001b[1mx-request-id\u001b[0m: req_d14494057c787e7b0d69bfb1d9bda8d8\r\r\n\u001b[1mstrict-transport-security\u001b[0m: max-age=31536000; includeSubDomains; preload\r\r\n\u001b[1mcf-cache-status\u001b[0m: DYNAMIC\r\r\n"]
[125.58066, "o", "\u001b[1mset-cookie\u001b[0m: __cf_bm=JqKehE_qcpPY5pJuL7RhkjfaF9pW7d46s7zA.Yro_pk-1734993824-1.0.1.1-4vlZYtAMYVYq7rbiuDKUrc3pH4eSnQkyGHjIwzcqmxvaOWWUsYNNUr9CrihiFz.RgvXVD1ZzjHRmO1QtYXQgrw; path=/; expires=Mon, 23-Dec-24 23:13:44 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None\r\r\n\u001b[1mx-content-type-options\u001b[0m: nosniff\r\r\n\u001b[1mset-cookie\u001b[0m: _cfuvid=DmuMdYfYMUy69Q5MxD1F8AvWuLwQpvEJpvaIbDvTDNg-1734993824507-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None\r\r\n\u001b[1mserver\u001b[0m: envoy\r\r\n\u001b[1mcf-ray\u001b[0m: 8f6bdf468ebe6818-SEA\r\r\n\u001b[1malt-svc\u001b[0m: h3=\":443\"; ma=86400\r\r\n\u001b[1mx-envoy-upstream-service-time\u001b[0m: 928\r\r\n\r\r\n{\"id\": \"chatcmpl-AhlRHFsWyWqMKBbr5ARU3gi7Dkiul\", \"object\": \"chat.completion\", \"created\": 1734993823, \"model\": \"gpt-4o-mini-2024-07-18\", \"choices\": [{\"index\": 0, \"message\": {\"role\": \"assistant\", \"content\": \"Enhance your Kubernetes cluster's efficiency with an AI gateway, streamlining API management, improving microservice communication, and optimizing resource utilization.\", \"r"]
[125.580787, "o", "efusal\": null}, \"logprobs\": null, \"finish_reason\": \"stop\"}], \"usage\": {\"prompt_tokens\": 64, \"completion_tokens\": 28, \"total_tokens\": 92, \"prompt_tokens_details\": {\"cached_tokens\": 0, \"audio_tokens\": 0}, \"completion_tokens_details\": {\"reasoning_tokens\": 0, \"audio_tokens\": 0, \"accepted_prediction_tokens\": 0, \"rejected_prediction_tokens\": 0}}, \"system_fingerprint\": \"fp_d02d531b47\"}"]
[125.582046, "o", "\r\n\r\nResponses should initially come from OpenAI unless the upstream is unhealthy, in which case it will fail over to qwen-0.5b.\r\n\r\n"]
[125.582101, "o", "Press Enter to send a request, or type 'next' to move on: "]
[135.436905, "o", "\r\n"]
[135.436976, "o", "\r\n"]
[135.437066, "o", "Sending request to OpenAI endpoint...\r\n"]
[135.4374, "o", "\r\n"]
[136.522002, "o", "HTTP/2 200 \r\r\n\u001b[1mdate\u001b[0m: Mon, 23 Dec 2024 22:43:55 GMT\r\r\n\u001b[1mcontent-type\u001b[0m: application/json\r\r\n\u001b[1maccess-control-expose-headers\u001b[0m: X-Request-ID\r\r\n\u001b[1mopenai-organization\u001b[0m: user-schxtck0mfttox4hkyxv6jfb\r\r\n\u001b[1mopenai-processing-ms\u001b[0m: 693\r\r\n\u001b[1mopenai-version\u001b[0m: 2020-10-01\r\r\n\u001b[1mx-ratelimit-limit-requests\u001b[0m: 10000\r\r\n\u001b[1mx-ratelimit-limit-tokens\u001b[0m: 200000\r\r\n\u001b[1mx-ratelimit-remaining-requests\u001b[0m: 9999\r\r\n\u001b[1mx-ratelimit-remaining-tokens\u001b[0m: 199913\r\r\n\u001b[1mx-ratelimit-reset-requests\u001b[0m: 8.64s\r\r\n\u001b[1mx-ratelimit-reset-tokens\u001b[0m: 25ms\r\r\n\u001b[1mx-request-id\u001b[0m: req_2af56d32d96f7d8ec8196de18cf22456\r\r\n\u001b[1mstrict-transport-security\u001b[0m: max-age=31536000; includeSubDomains; preload\r\r\n"]
[136.522089, "o", "\u001b[1mcf-cache-status\u001b[0m: DYNAMIC\r\r\n\u001b[1mset-cookie\u001b[0m: __cf_bm=UPaYkIgdNrKJrg9QKwguYwxmwLYvnbplHp70xKBfoUU-1734993835-1.0.1.1-jorr187KTRmjjn80O9TGeY24cp1rL3uZki1hyXQdPBOzXQY35hG7YovwJfFDOKCJeItLavGzh43VZ5ugCe3sfw; path=/; expires=Mon, 23-Dec-24 23:13:55 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None\r\r\n\u001b[1mx-content-type-options\u001b[0m: nosniff\r\r\n\u001b[1mset-cookie\u001b[0m: _cfuvid=JkMye0fTnRIQaCwUWXkjrSVpFWNY9HVTO.D2xftJquY-1734993835378-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None\r\r\n\u001b[1mserver\u001b[0m: envoy\r\r\n\u001b[1mcf-ray\u001b[0m: 8f6bdf8a1bf2df18-SEA\r\r\n\u001b[1malt-svc\u001b[0m: h3=\":443\"; ma=86400\r\r\n\u001b[1mx-envoy-upstream-service-time\u001b[0m: 1023\r\r\n\r\r\n{\"id\": \"chatcmpl-AhlRSGHKiVFE1AtNlLNSxE3Laweyy\", \"object\": \"chat.completion\", \"created\": 1734993834, \"model\": \"gpt-4o-mini-2024-07-18\", \"choices\": [{\"index\": 0, \"message\": {\"role\": \"assistant\", \"content\": \"An AI gateway in your Kubernetes cluster streamlines AI model management, enhances scalability, and simplifies integration for efficient,"]
[136.522136, "o", " intelligent applications.\", \"refusal\": null}, \"logprobs\": null, \"finish_reason\": \"stop\"}], \"usage\": {\"prompt_tokens\": 64, \"completion_tokens\": 26, \"total_tokens\": 90, \"prompt_tokens_details\": {\"cached_tokens\": 0, \"audio_tokens\": 0}, \"completion_tokens_details\": {\"reasoning_tokens\": 0, \"audio_tokens\": 0, \"accepted_prediction_tokens\": 0, \"rejected_prediction_tokens\": 0}}, \"system_fingerprint\": \"fp_d02d531b47\"}"]
[136.522659, "o", "\r\n\r\nResponses should initially come from OpenAI unless the upstream is unhealthy, in which case it will fail over to qwen-0.5b.\r\n"]
[136.522675, "o", "\r\nPress Enter to send a request, or type 'next' to move on: "]
[140.694126, "o", "n"]
[140.808369, "o", "e"]
[140.998931, "o", "x"]
[141.23442, "o", "t"]
[142.8776, "o", "\r\n"]
[142.877835, "o", "\r\nExiting OpenAI failover test.\r\n\r\nStep 11: Simulate error for OpenAI failover. Press enter to proceed..."]
[146.296996, "o", "\r\n"]
[146.303683, "o", "apiVersion: gloo.solo.io/v1\r\nkind: Upstream\r\nmetadata:\r\n  labels:\r\n    app: gloo\r\n  name: openai-to-local-upstream\r\n  namespace: gloo-system\r\nspec:\r\n  ai:\r\n    multi:\r\n      priorities:\r\n      - pool:\r\n        - openai:\r\n            customHost:\r\n              # invalid host\r\n              #host: invalidhost.foo.bar\r\n              # 429 status code\r\n              host: httpbin.org/status/429\r\n            model: gpt-4o-mini\r\n            authToken:\r\n              secretRef:\r\n                name: openai-secret\r\n                namespace: gloo-system\r\n      - pool:\r\n        - openai:\r\n            customHost:\r\n              host: ollama-qwen.ollama.svc.cluster.local\r\n              port: 11434\r\n            model: qwen:0.5b"]
[146.304042, "o", "\r\n"]
[146.427052, "o", "upstream.gloo.solo.io/openai-to-local-upstream configured\r\n"]
[146.428487, "o", "\r\n"]
[146.428613, "o", "Simulated error configuration applied to OpenAI failover upstream.\r\n\r\nTesting failover with simulated error.\r\nPress Enter to send a request, or type 'next' to move on: "]
[154.574229, "o", "\r\n"]
[154.574506, "o", "Sending request to OpenAI endpoint with simulated error...\r\n"]
[155.256753, "o", "HTTP/2 200 \r\r\n\u001b[1mcontent-type\u001b[0m: application/json\r\r\n\u001b[1mdate\u001b[0m: Mon, 23 Dec 2024 22:44:14 GMT\r\r\n\u001b[1mx-envoy-upstream-service-time\u001b[0m: 625\r\r\n\u001b[1mserver\u001b[0m: envoy\r\r\n\r\r\n"]
[155.256783, "o", "{\"id\": \"chatcmpl-219\", \"object\": \"chat.completion\", \"created\": 1734993854, \"model\": \"qwen:0.5b\", \"system_fingerprint\": \"fp_ollama\", \"choices\": [{\"index\": 0, \"message\": {\"role\": \"assistant\", \"content\": \"Using an AI gateway allows you to centralize your API requests and control them programmatically. This benefits security, error handling, and scalability. By using an AI gateway, you can modernize and streamline the aspects of your Kubernetes cluster.\"}, \"finish_reason\": \"stop\"}], \"usage\": {\"prompt_tokens\": 66, \"completion_tokens\": 48, \"total_tokens\": 114}}"]
[155.257349, "o", "\r\n\r\nResponses should now fail over to qwen-0.5b since the OpenAI upstream is unhealthy.\r\n\r\n"]
[155.257362, "o", "Press Enter to send a request, or type 'next' to move on: "]
[159.48992, "o", "\r\n"]
[159.490163, "o", "Sending request to OpenAI endpoint with simulated error...\r\n"]
[160.508843, "o", "HTTP/2 200 \r\r\n\u001b[1mcontent-type\u001b[0m: application/json\r\r\n\u001b[1mdate\u001b[0m: Mon, 23 Dec 2024 22:44:19 GMT\r\r\n\u001b[1mx-envoy-upstream-service-time\u001b[0m: 948\r\r\n\u001b[1mserver\u001b[0m: envoy\r\r\n\r\r\n{\"id\": \"chatcmpl-675\", \"object\": \"chat.completion\", \"created\": 1734993859, \"model\": \"qwen:0.5b\", \"system_fingerprint\": \"fp_ollama\", \"choices\": [{\"index\": 0, \"message\": {\"role\": \"assistant\", \"content\": \"AI gateways allow you to centralize access to various APIs on your Kubernetes cluster. By using an AI gateway, you can improve collaboration between your team members while enabling them to quickly access the required information. Additionally, AI gateways can help reduce response time and increase efficiency in your Kubernetes cluster. Furthermore, using AI gateways allows you to easily integrate other technologies or tools into your Kubernetes cluster.\"}, \"finish_reason\": \"stop\"}], \"usage\": {\"prompt_tokens\": 66, \"completion_tokens\": 81, \"total_tokens\": 147}}"]
[160.509476, "o", "\r\n\r\nResponses should now fail over to qwen-0.5b since the OpenAI upstream is unhealthy.\r\n\r\n"]
[160.50949, "o", "Press Enter to send a request, or type 'next' to move on: "]
[162.8919, "o", "n"]
[162.979333, "o", "e"]
[163.155948, "o", "x"]
[163.372471, "o", "t"]
[164.855703, "o", "\r\n"]
[164.855949, "o", "Exiting simulated error test.\r\n\r\n"]
[164.856035, "o", "Step 11: Cleanup demo resources. Press enter to proceed..."]
[168.448181, "o", "\r\n"]
[168.506899, "o", "httproute.gateway.networking.k8s.io \"openai-to-local-route\" deleted\r\n"]
[168.509637, "o", "routeoption.gateway.solo.io \"openai-to-local-route-policies\" deleted\r\n"]
[168.516519, "o", "upstream.gloo.solo.io \"openai-to-local-upstream\" deleted\r\n"]
[168.557734, "o", "httproute.gateway.networking.k8s.io \"ollama-qwen-failover\" deleted\r\n"]
[168.560294, "o", "routeoption.gateway.solo.io \"ollama-qwen-failover-route-policies\" deleted\r\n"]
[168.566743, "o", "upstream.gloo.solo.io \"aig-failover\" deleted\r\n"]
[168.611863, "o", "upstream.gloo.solo.io \"ollama-qwen-0.5-upstream\" deleted\r\n"]
[168.617477, "o", "upstream.gloo.solo.io \"ollama-qwen-1.8-upstream\" deleted\r\n"]
[168.622085, "o", "httproute.gateway.networking.k8s.io \"ollama-qwen\" deleted\r\n"]
[168.6269, "o", "routeoption.gateway.solo.io \"ollama-qwen-route-policies\" deleted\r\n"]
[168.63486, "o", "Demo resources cleaned up.\r\n\r\nEND OF DEMO\r\n"]
[168.635345, "o", "\u001b[1m\u001b[7m%\u001b[27m\u001b[1m\u001b[0m                                                                                                                                                               \r \r"]
[168.63541, "o", "\r\u001b[0m\u001b[27m\u001b[24m\u001b[Jalexly-solo@solo-system-aly lb-failover-demo % \u001b[K\u001b[?2004h"]
[171.931066, "o", "\u001b[?2004l\r\r\n"]
